<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OAuth library functions: tests/selftest_wiki.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>tests/selftest_wiki.c</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#ifdef TEST_UNICODE</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;locale.h&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="oauth_8h.html" title="OAuth.net implementation in POSIX-C.">oauth.h</a>&gt;</span>

<span class="preprocessor">#include &quot;commontest.h&quot;</span>

<span class="keywordtype">int</span> loglevel = 1; <span class="comment">//&lt; report each successful test</span>

<span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <span class="keywordtype">int</span> fail=0;
  <span class="keywordtype">char</span> *b64d;
  <span class="keywordtype">char</span> *testurl, *testkey;
<span class="preprocessor"> #ifdef TEST_UNICODE</span>
<span class="preprocessor"></span>  <span class="keywordtype">wchar_t</span> src[] = {0x000A, 0};
<span class="preprocessor"> #endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span> (loglevel) printf(<span class="stringliteral">&quot;\n *** testing liboauth against http://wiki.oauth.net/TestCases (july 2008) ***\n&quot;</span>);

  <span class="comment">// http://wiki.oauth.net/TestCases</span>
  fail|=test_encoding(<span class="stringliteral">&quot;abcABC123&quot;</span>,<span class="stringliteral">&quot;abcABC123&quot;</span>);
  fail|=test_encoding(<span class="stringliteral">&quot;-._~&quot;</span>,<span class="stringliteral">&quot;-._~&quot;</span>);
  fail|=test_encoding(<span class="stringliteral">&quot;%&quot;</span>,<span class="stringliteral">&quot;%25&quot;</span>);
  fail|=test_encoding(<span class="stringliteral">&quot;+&quot;</span>,<span class="stringliteral">&quot;%2B&quot;</span>);
  fail|=test_encoding(<span class="stringliteral">&quot;&amp;=*&quot;</span>,<span class="stringliteral">&quot;%26%3D%2A&quot;</span>);

<span class="preprocessor"> #ifdef TEST_UNICODE</span>
<span class="preprocessor"></span>  src[0] = 0x000A; fail|=test_uniencoding(src,<span class="stringliteral">&quot;%0A&quot;</span>);
  src[0] = 0x0020; fail|=test_uniencoding(src,<span class="stringliteral">&quot;%20&quot;</span>);
  src[0] = 0x007F; fail|=test_uniencoding(src,<span class="stringliteral">&quot;%7F&quot;</span>);
  src[0] = 0x0080; fail|=test_uniencoding(src,<span class="stringliteral">&quot;%C2%80&quot;</span>);
  src[0] = 0x3001; fail|=test_uniencoding(src,<span class="stringliteral">&quot;%E3%80%81&quot;</span>);
<span class="preprocessor"> #endif</span>
<span class="preprocessor"></span>
  fail|=test_normalize(<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;name=&quot;</span>);
  fail|=test_normalize(<span class="stringliteral">&quot;a=b&quot;</span>, <span class="stringliteral">&quot;a=b&quot;</span>);
  fail|=test_normalize(<span class="stringliteral">&quot;a=b&amp;c=d&quot;</span>, <span class="stringliteral">&quot;a=b&amp;c=d&quot;</span>);
  fail|=test_normalize(<span class="stringliteral">&quot;a=x!y&amp;a=x+y&quot;</span>, <span class="stringliteral">&quot;a=x%20y&amp;a=x%21y&quot;</span>);
  fail|=test_normalize(<span class="stringliteral">&quot;x!y=a&amp;x=a&quot;</span>, <span class="stringliteral">&quot;x=a&amp;x%21y=a&quot;</span>);

  fail|=test_request(<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;http://example.com/&quot;</span> <span class="stringliteral">&quot;?&quot;</span> 
      <span class="stringliteral">&quot;n=v&quot;</span>,
  <span class="comment">// expect:</span>
      <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fexample.com%2F&amp;n%3Dv&quot;</span>);

  fail|=test_request(<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;http://example.com&quot;</span> <span class="stringliteral">&quot;?&quot;</span> 
      <span class="stringliteral">&quot;n=v&quot;</span>,
  <span class="comment">// expect:</span>
      <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fexample.com%2F&amp;n%3Dv&quot;</span>);

  fail|=test_request(<span class="stringliteral">&quot;POST&quot;</span>, <span class="stringliteral">&quot;https://photos.example.net/request_token&quot;</span> <span class="stringliteral">&quot;?&quot;</span> 
      <span class="stringliteral">&quot;oauth_version=1.0&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_consumer_key=dpf43f3p2l4k3l03&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_timestamp=1191242090&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_nonce=hsu94j3884jdopsl&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_signature_method=PLAINTEXT&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_signature=ignored&quot;</span>,
  <span class="comment">// expect:</span>
      <span class="stringliteral">&quot;POST&amp;https%3A%2F%2Fphotos.example.net%2Frequest_token&amp;oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce%3Dhsu94j3884jdopsl%26oauth_signature_method%3DPLAINTEXT%26oauth_timestamp%3D1191242090%26oauth_version%3D1.0&quot;</span>);

  fail|=test_request(<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;http://photos.example.net/photos&quot;</span> <span class="stringliteral">&quot;?&quot;</span> 
      <span class="stringliteral">&quot;file=vacation.jpg&amp;size=original&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_version=1.0&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_consumer_key=dpf43f3p2l4k3l03&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_token=nnch734d00sl2jdk&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_timestamp=1191242096&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_nonce=kllo9940pd9333jh&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_signature=ignored&quot;</span>
      <span class="stringliteral">&quot;&amp;oauth_signature_method=HMAC-SHA1&quot;</span>,
  <span class="comment">// expect:</span>
      <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fphotos.example.net%2Fphotos&amp;file%3Dvacation.jpg%26oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce%3Dkllo9940pd9333jh%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1191242096%26oauth_token%3Dnnch734d00sl2jdk%26oauth_version%3D1.0%26size%3Doriginal&quot;</span>);

  fail|=test_sha1(<span class="stringliteral">&quot;cs&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;bs&quot;</span>,<span class="stringliteral">&quot;egQqG5AJep5sJ7anhXju1unge2I=&quot;</span>);
  fail|=test_sha1(<span class="stringliteral">&quot;cs&quot;</span>,<span class="stringliteral">&quot;ts&quot;</span>,<span class="stringliteral">&quot;bs&quot;</span>,<span class="stringliteral">&quot;VZVjXceV7JgPq/dOTnNmEfO0Fv8=&quot;</span>);
  fail|=test_sha1(<span class="stringliteral">&quot;kd94hf93k423kf44&quot;</span>,<span class="stringliteral">&quot;pfkkdhi9sl3r4s00&quot;</span>,<span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fphotos.example.net%2Fphotos&amp;file%3Dvacation.jpg%26oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce%3Dkllo9940pd9333jh%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1191242096%26oauth_token%3Dnnch734d00sl2jdk%26oauth_version%3D1.0%26size%3Doriginal&quot;</span>,<span class="stringliteral">&quot;tR3+Ty81lMeYAr/Fid0kMTYa/WM=&quot;</span>);

  <span class="comment">// HMAC-SHA1 selftest.</span>
  <span class="comment">// see http://oauth.net/core/1.0/#anchor25 </span>
  testurl = <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fphotos.example.net%2Fphotos&amp;file%3D&quot;</span>
      <span class="stringliteral">&quot;vacation.jpg%26oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce&quot;</span>
      <span class="stringliteral">&quot;%3Dkllo9940pd9333jh%26oauth_signature_method%3DHMAC-SHA1%26o&quot;</span>
      <span class="stringliteral">&quot;auth_timestamp%3D1191242096%26oauth_token%3Dnnch734d00sl2jdk&quot;</span>
      <span class="stringliteral">&quot;%26oauth_version%3D1.0%26size%3Doriginal&quot;</span>;

  testkey = <span class="stringliteral">&quot;kd94hf93k423kf44&amp;pfkkdhi9sl3r4s00&quot;</span>;
  b64d = <a name="a0"></a><a class="code" href="oauth_8h.html#a580e3818dbb5c58804b8b17760c31d2d" title="returns base64 encoded HMAC-SHA1 signature for given message and key.">oauth_sign_hmac_sha1</a>(testurl , testkey);
  <span class="keywordflow">if</span> (strcmp(b64d,<span class="stringliteral">&quot;tR3+Ty81lMeYAr/Fid0kMTYa/WM=&quot;</span>)) {
    printf(<span class="stringliteral">&quot;HMAC-SHA1 signature test failed.\n&quot;</span>);
    fail|=1;
  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loglevel)
    printf(<span class="stringliteral">&quot;HMAC-SHA1 signature test successful.\n&quot;</span>);
  free(b64d);

  <span class="comment">// rsa-signature based on http://wiki.oauth.net/TestCases example</span>
  b64d = <a name="a1"></a><a class="code" href="oauth_8h.html#a8765ee5cb164826b66582d51ce43e943" title="returns RSA-SHA1 signature for given data.">oauth_sign_rsa_sha1</a>(
    <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fphotos.example.net%2Fphotos&amp;file%3Dvacaction.jpg%26oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce%3D13917289812797014437%26oauth_signature_method%3DRSA-SHA1%26oauth_timestamp%3D1196666512%26oauth_version%3D1.0%26size%3Doriginal&quot;</span>,

    <span class="stringliteral">&quot;-----BEGIN PRIVATE KEY-----\n&quot;</span>
    <span class="stringliteral">&quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALRiMLAh9iimur8V\n&quot;</span>
    <span class="stringliteral">&quot;A7qVvdqxevEuUkW4K+2KdMXmnQbG9Aa7k7eBjK1S+0LYmVjPKlJGNXHDGuy5Fw/d\n&quot;</span>
    <span class="stringliteral">&quot;7rjVJ0BLB+ubPK8iA/Tw3hLQgXMRRGRXXCn8ikfuQfjUS1uZSatdLB81mydBETlJ\n&quot;</span>
    <span class="stringliteral">&quot;hI6GH4twrbDJCR2Bwy/XWXgqgGRzAgMBAAECgYBYWVtleUzavkbrPjy0T5FMou8H\n&quot;</span>
    <span class="stringliteral">&quot;X9u2AC2ry8vD/l7cqedtwMPp9k7TubgNFo+NGvKsl2ynyprOZR1xjQ7WgrgVB+mm\n&quot;</span>
    <span class="stringliteral">&quot;uScOM/5HVceFuGRDhYTCObE+y1kxRloNYXnx3ei1zbeYLPCHdhxRYW7T0qcynNmw\n&quot;</span>
    <span class="stringliteral">&quot;rn05/KO2RLjgQNalsQJBANeA3Q4Nugqy4QBUCEC09SqylT2K9FrrItqL2QKc9v0Z\n&quot;</span>
    <span class="stringliteral">&quot;zO2uwllCbg0dwpVuYPYXYvikNHHg+aCWF+VXsb9rpPsCQQDWR9TT4ORdzoj+Nccn\n&quot;</span>
    <span class="stringliteral">&quot;qkMsDmzt0EfNaAOwHOmVJ2RVBspPcxt5iN4HI7HNeG6U5YsFBb+/GZbgfBT3kpNG\n&quot;</span>
    <span class="stringliteral">&quot;WPTpAkBI+gFhjfJvRw38n3g/+UeAkwMI2TJQS4n8+hid0uus3/zOjDySH3XHCUno\n&quot;</span>
    <span class="stringliteral">&quot;cn1xOJAyZODBo47E+67R4jV1/gzbAkEAklJaspRPXP877NssM5nAZMU0/O/NGCZ+\n&quot;</span>
    <span class="stringliteral">&quot;3jPgDUno6WbJn5cqm8MqWhW1xGkImgRk+fkDBquiq4gPiT898jusgQJAd5Zrr6Q8\n&quot;</span>
    <span class="stringliteral">&quot;AO/0isr/3aa6O6NLQxISLKcPDk2NOccAfS/xOtfOz4sJYM3+Bs4Io9+dZGSDCA54\n&quot;</span>
    <span class="stringliteral">&quot;Lw03eHTNQghS0A==\n&quot;</span>
    <span class="stringliteral">&quot;-----END PRIVATE KEY-----&quot;</span>);

  <span class="keywordflow">if</span> (strcmp(b64d,<span class="stringliteral">&quot;jvTp/wX1TYtByB1m+Pbyo0lnCOLIsyGCH7wke8AUs3BpnwZJtAuEJkvQL2/9n4s5wUmUl4aCI4BwpraNx4RtEXMe5qg5T1LVTGliMRpKasKsW//e+RinhejgCuzoH26dyF8iY2ZZ/5D1ilgeijhV/vBka5twt399mXwaYdCwFYE=&quot;</span>)) {
    printf(<span class="stringliteral">&quot;RSA-SHA1 signature test failed.\n&quot;</span>);
    fail|=1;
  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loglevel)
    printf(<span class="stringliteral">&quot;RSA-SHA1 signature test successful.\n&quot;</span>);
  free(b64d);

  <span class="keywordflow">if</span> (<a name="a2"></a><a class="code" href="oauth_8h.html#a00e968a8b1c196079ea7e8aa9526442c" title="verify RSA-SHA1 signature.">oauth_verify_rsa_sha1</a>(
    <span class="stringliteral">&quot;GET&amp;http%3A%2F%2Fphotos.example.net%2Fphotos&amp;file%3Dvacaction.jpg%26oauth_consumer_key%3Ddpf43f3p2l4k3l03%26oauth_nonce%3D13917289812797014437%26oauth_signature_method%3DRSA-SHA1%26oauth_timestamp%3D1196666512%26oauth_version%3D1.0%26size%3Doriginal&quot;</span>,

    <span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span>
    <span class="stringliteral">&quot;MIIBpjCCAQ+gAwIBAgIBATANBgkqhkiG9w0BAQUFADAZMRcwFQYDVQQDDA5UZXN0\n&quot;</span>
    <span class="stringliteral">&quot;IFByaW5jaXBhbDAeFw03MDAxMDEwODAwMDBaFw0zODEyMzEwODAwMDBaMBkxFzAV\n&quot;</span>
    <span class="stringliteral">&quot;BgNVBAMMDlRlc3QgUHJpbmNpcGFsMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKB\n&quot;</span>
    <span class="stringliteral">&quot;gQC0YjCwIfYoprq/FQO6lb3asXrxLlJFuCvtinTF5p0GxvQGu5O3gYytUvtC2JlY\n&quot;</span>
    <span class="stringliteral">&quot;zypSRjVxwxrsuRcP3e641SdASwfrmzyvIgP08N4S0IFzEURkV1wp/IpH7kH41Etb\n&quot;</span>
    <span class="stringliteral">&quot;mUmrXSwfNZsnQRE5SYSOhh+LcK2wyQkdgcMv11l4KoBkcwIDAQABMA0GCSqGSIb3\n&quot;</span>
    <span class="stringliteral">&quot;DQEBBQUAA4GBAGZLPEuJ5SiJ2ryq+CmEGOXfvlTtEL2nuGtr9PewxkgnOjZpUy+d\n&quot;</span>
    <span class="stringliteral">&quot;4TvuXJbNQc8f4AMWL/tO9w0Fk80rWKp9ea8/df4qMq5qlFWlx6yOLQxumNOmECKb\n&quot;</span>
    <span class="stringliteral">&quot;WpkUQDIDJEoFUzKMVuJf4KO/FJ345+BNLGgbJ6WujreoM1X/gYfdnJ/J\n&quot;</span>
    <span class="stringliteral">&quot;-----END CERTIFICATE-----\n&quot;</span>, 
    <span class="stringliteral">&quot;jvTp/wX1TYtByB1m+Pbyo0lnCOLIsyGCH7wke8AUs3BpnwZJtAuEJkvQL2/9n4s5wUmUl4aCI4BwpraNx4RtEXMe5qg5T1LVTGliMRpKasKsW//e+RinhejgCuzoH26dyF8iY2ZZ/5D1ilgeijhV/vBka5twt399mXwaYdCwFYE=&quot;</span>)
      != 1) {
    printf(<span class="stringliteral">&quot;RSA-SHA1 verify-signature test failed.\n&quot;</span>);
    fail|=1;
  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loglevel)
    printf(<span class="stringliteral">&quot;RSA-SHA1 verify-signature test successful.\n&quot;</span>);

  <span class="comment">// report</span>
  <span class="keywordflow">if</span> (fail) {
    printf(<span class="stringliteral">&quot;\n !!! One or more tests from http://wiki.oauth.net/TestCases failed.\n\n&quot;</span>);
  } <span class="keywordflow">else</span> {
    printf(<span class="stringliteral">&quot; *** http://wiki.oauth.net/TestCases verified sucessfully.\n&quot;</span>);
  }

  <span class="keywordflow">return</span> (fail?1:0);
}
</pre></div> </div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>

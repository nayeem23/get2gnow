<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OAuth library functions: tests/oauthtest2.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>tests/oauthtest2.c</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="oauth_8h.html" title="OAuth.net implementation in POSIX-C.">oauth.h</a>&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * a example requesting and parsing a request-token from an OAuth service-provider</span>
<span class="comment"> * using OAuth HTTP Authorization header:</span>
<span class="comment"> * see http://oauth.net/core/1.0a/#auth_header</span>
<span class="comment"> * and http://oauth.net/core/1.0a/#consumer_req_param</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> request_token_example_get(<span class="keywordtype">void</span>) {
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *request_token_uri = <span class="stringliteral">&quot;http://localhost/oauthtest.php?test=test&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *req_c_key         = <span class="stringliteral">&quot;17b09ea4c9a4121145936f0d7d8daa28047583796&quot;</span>; <span class="comment">//&lt; consumer key</span>
  <span class="keyword">const</span> <span class="keywordtype">char</span> *req_c_secret      = <span class="stringliteral">&quot;942295b08ffce77b399419ee96ac65be&quot;</span>; <span class="comment">//&lt; consumer secret</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *request_token_uri = <span class="stringliteral">&quot;http://term.ie/oauth/example/request_token.php&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *req_c_key         = <span class="stringliteral">&quot;key&quot;</span>; <span class="comment">//&lt; consumer key</span>
  <span class="keyword">const</span> <span class="keywordtype">char</span> *req_c_secret      = <span class="stringliteral">&quot;secret&quot;</span>; <span class="comment">//&lt; consumer secret</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  <span class="keywordtype">char</span> *res_t_key    = NULL; <span class="comment">//&lt; replied key</span>
  <span class="keywordtype">char</span> *res_t_secret = NULL; <span class="comment">//&lt; replied secret</span>

  <span class="keywordtype">char</span> *req_url = NULL;
  <span class="keywordtype">char</span> *req_hdr = NULL;
  <span class="keywordtype">char</span> *http_hdr= NULL;
  <span class="keywordtype">char</span> *reply;


  <span class="comment">//req_url = oauth_sign_url2(request_token_uri, NULL, OA_HMAC, NULL, req_c_key, req_c_secret, NULL, NULL);</span>

  <span class="comment">// oauth_sign_url2 (see oauth.h) in steps</span>
  <span class="keywordtype">int</span>  argc;
  <span class="keywordtype">char</span> **argv = NULL;

  argc = <a name="a0"></a><a class="code" href="oauth_8h.html#a55fbfb191d98e3b6bf197495aae35e3a" title="splits the given url into a parameter array.">oauth_split_url_parameters</a>(request_token_uri, &amp;argv);

  <a name="a1"></a><a class="code" href="oauth_8h.html#aacc04698e00c7b4a61857dfacdfa6d58" title="the back-end behind by /ref oauth_sign_array2.">oauth_sign_array2_process</a>(&amp;argc, &amp;argv,
          NULL, <span class="comment">//&lt; postargs (unused)</span>
          <a name="a2"></a><a class="code" href="oauth_8h.html#a3794693efae6b44677be23834844e9d2a7113d5ffff7ee3a530150cdfe1618ae7" title="use HMAC-SHA1 request signing method">OA_HMAC</a>,
          NULL, <span class="comment">//&lt; HTTP method (defaults to &quot;GET&quot;)</span>
          req_c_key, req_c_secret, NULL, NULL);

  <span class="comment">// &#39;default&#39; oauth_sign_url2 would do:</span>
  <span class="comment">// req_url = oauth_serialize_url(argc, 0, argv);</span>
 
  <span class="comment">// we split [x_]oauth_ parameters (for use in HTTP Authorization header)</span>
  req_hdr = <a name="a3"></a><a class="code" href="oauth_8h.html#af53513a91b7415d7a6a4cd03952a4049" title="encode query parameters from an array.">oauth_serialize_url_sep</a>(argc, 1, argv, <span class="stringliteral">&quot;, &quot;</span>, 6);
  <span class="comment">// and other URL parameters </span>
  req_url = <a class="code" href="oauth_8h.html#af53513a91b7415d7a6a4cd03952a4049" title="encode query parameters from an array.">oauth_serialize_url_sep</a>(argc, 0, argv, <span class="stringliteral">&quot;&amp;&quot;</span>, 1);

  <a name="a4"></a><a class="code" href="oauth_8h.html#ada81dd39be59cadbc1bd77df78ffef52" title="free array args">oauth_free_array</a>(&amp;argc, &amp;argv);

  <span class="comment">// done with OAuth stuff, now perform the HTTP request.</span>
  http_hdr = malloc(strlen(req_hdr) + 55);

  <span class="comment">// Note that (optional) &#39;realm&#39; is not to be </span>
  <span class="comment">// included in the oauth signed parameters and thus only added here.</span>
  <span class="comment">// see 9.1.1 in http://oauth.net/core/1.0/#anchor14</span>
  sprintf(http_hdr, <span class="stringliteral">&quot;Authorization: OAuth realm=\&quot;http://example.org/\&quot;, %s&quot;</span>, req_hdr);

  printf(<span class="stringliteral">&quot;request URL=%s\n&quot;</span>, req_url);
  printf(<span class="stringliteral">&quot;request header=%s\n\n&quot;</span>, http_hdr);
  reply = <a name="a5"></a><a class="code" href="oauth_8h.html#a279907cffe1f5513c1185dfc31223310" title="do a HTTP GET request, wait for it to finish and return the content of the reply.">oauth_http_get2</a>(req_url,NULL, http_hdr);
  <span class="keywordflow">if</span> (!reply) 
    printf(<span class="stringliteral">&quot;HTTP request for an oauth request-token failed.\n&quot;</span>);
  <span class="keywordflow">else</span> {
    <span class="comment">// parse reply - example:</span>
    <span class="comment">//&quot;oauth_token=2a71d1c73d2771b00f13ca0acb9836a10477d3c56&amp;oauth_token_secret=a1b5c00c1f3e23fb314a0aa22e990266&quot;</span>
    <span class="keywordtype">int</span> rc;
    <span class="keywordtype">char</span> **rv = NULL;

    printf(<span class="stringliteral">&quot;HTTP-reply: %s\n&quot;</span>, reply);
    rc = <a class="code" href="oauth_8h.html#a55fbfb191d98e3b6bf197495aae35e3a" title="splits the given url into a parameter array.">oauth_split_url_parameters</a>(reply, &amp;rv);
    qsort(rv, rc, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *), <a name="a6"></a><a class="code" href="oauth_8h.html#a01769febf93ebffe0f572a89ed1e529a" title="string compare function for oauth parameters.">oauth_cmpstringp</a>);
    <span class="keywordflow">if</span>( rc==2 
        &amp;&amp; !strncmp(rv[0],<span class="stringliteral">&quot;oauth_token=&quot;</span>,11)
        &amp;&amp; !strncmp(rv[1],<span class="stringliteral">&quot;oauth_token_secret=&quot;</span>,18) ){
          res_t_key=strdup(&amp;(rv[0][12]));
          res_t_secret=strdup(&amp;(rv[1][19]));
          printf(<span class="stringliteral">&quot;key:    &#39;%s&#39;\nsecret: &#39;%s&#39;\n&quot;</span>,res_t_key, res_t_secret);
    }
    <span class="keywordflow">if</span>(rv) free(rv);
  }

  <span class="keywordflow">if</span>(req_url) free(req_url);
  <span class="keywordflow">if</span>(req_hdr) free(req_hdr);
  <span class="keywordflow">if</span>(http_hdr)free(http_hdr);
  <span class="keywordflow">if</span>(reply) free(reply);
  <span class="keywordflow">if</span>(res_t_key) free(res_t_key);
  <span class="keywordflow">if</span>(res_t_secret) free(res_t_secret);
}

<span class="comment">/*</span>
<span class="comment"> * Main Test and Example Code.</span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  request_token_example_get();
  <span class="keywordflow">return</span> (0);
}
</pre></div> </div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
